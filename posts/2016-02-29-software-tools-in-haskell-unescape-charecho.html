<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>nbloomf.github.io - Software Tools in Haskell: unescape, charecho</title>
<link rel="stylesheet" type="text/css" href="../css/default.css" />
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>

<body>
<div id="header">
  <div id="logo">
    <a href="../index.html">nbloomf</a>
  </div>
  <div id="navigation">
    <a href="../index.html">Home</a>
    <a href="../about.html">About</a>
    <a href="../contact.html">Contact</a>
    <a href="../archive.html">Posts</a>
  </div>
</div>

<div id="content">
<h1>Software Tools in Haskell: unescape, charecho</h1>
<!-- BEGIN BODY -->
<div class="info">
Posted on 2016-02-29 by nbloomf
</div>

<!-- LaTeX Macros -->
<div class="invisible">
\(\newcommand{\id}{\mathsf{id}}\)
\(\newcommand{\const}{\mathsf{const}}\)

\(\newcommand{\nats}{\mathbb{N}}\)
\(\newcommand{\zero}{\mathsf{0}}\)
\(\newcommand{\next}{\mathsf{next}}\)
\(\newcommand{\natrec}[2]{\left\langle\!\left\vert #1, #2 \right\vert\!\right\rangle}\)
\(\newcommand{\primrec}[2]{\left[\!\left[ #1, #2 \right]\!\right]}\)

\(\newcommand{\nplus}{\mathsf{plus}}\)
\(\newcommand{\ntimes}{\mathsf{times}}\)
\(\newcommand{\npower}{\mathsf{power}}\)

\(\newcommand{\bool}{\mathbb{B}}\)
\(\newcommand{\btrue}{\mathsf{t}}\)
\(\newcommand{\bfalse}{\mathsf{f}}\)
\(\newcommand{\bnot}{\mathsf{not}}\)
\(\newcommand{\band}{\mathsf{and}}\)
\(\newcommand{\bor}{\mathsf{or}}\)
</div>
<!-- End LaTeX Macros -->

<p>This post is part of the <a href="../posts/2016-02-10-software-tools-in-haskell.html">Software Tools in Haskell</a> series.</p>
<p>Today I feel like going off script. (These are not in <em>Software Tools</em>.)</p>
<p><a name="unescape"></a></p>
<h2 id="unescape-interpret-c-and-ascii-backslash-escape-codes-on-stdin"><code>unescape</code>: interpret C and ASCII backslash escape codes on stdin</h2>
<p>While testing the <code>overstrike</code> program, I ran into an inconvenient problem: I couldn’t find an easy and consistent way to type control characters (namely backspace, but others have the same problem) that works both in my terminal and in my golden test suite. It seems like every program - the terminal, the shell, the test runner - wants to interpret these characters in its own way. This problem is a good candidate for a filter-style program. <code>unescape</code> reads lines from stdin and interprets any C-style escape sequences or ASCII abbreviations it finds. (There is a nice wiki page on <a href="https://en.wikipedia.org/wiki/Escape_sequences_in_C">C-style escape sequences</a>, and the page on <a href="https://en.wikipedia.org/wiki/ASCII#ASCII_control_code_chart">ASCII</a> includes a table of abbreviations.)</p>
<p>The main program is simple enough, as it simply munches through the lines on stdin looking for escape codes.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">-- sth-unescape: interpret C and ASCII backslash escape codes on stdin</span>
<span class="co">--   character-oriented</span>

<span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">SoftwareTools.Lib</span>
  (exitSuccess)
<span class="kw">import </span><span class="dt">SoftwareTools.Lib.IO</span>
  (charFilter)
<span class="kw">import </span><span class="dt">SoftwareTools.Lib.Text</span>
  (backslashUnEscape)


<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> <span class="kw">do</span>
  charFilter backslashUnEscape
  exitSuccess</code></pre></div>
<p>The real work is done by the library function <code>backslashUnEscape</code>. There’s no nice way to do this, so we pattern match on the prefix of a string looking for escape codes. One gotcha: the ASCII abbreviations are not prefix free; for instance the meaning of the string <code>\SOHello</code> is ambiguous; is it <code>\SO</code> (Shift Out) followed by <code>Hello</code> or <code>\SOH</code> (Start Of Heading) followed by <code>ello</code>? To make sure these are detected correctly, we pattern match <code>\SOH</code> first (since otherwise that string would always match as <code>\SO</code> followed by <code>H</code>) and add one more escape code, <code>\&amp;</code> (taken from Haskell), for those occasions when you <em>really</em> want <code>\SO</code> followed by <code>H</code> not interpreted as <code>\SOH</code>. <code>\&amp;</code> represents the empty string, so we can do this with <code>\SO\&amp;H</code>. So, you know, for all those times you need carefully formatted ASCII control codes.</p>
<p><code>backslashUnEscape</code> is a library function because it will probably be useful later for parsing command line arguments.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">backslashUnEscape ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span>
backslashUnEscape <span class="fu">=</span> concat <span class="fu">.</span> unfoldr firstChar
  <span class="kw">where</span>
<span class="ot">    firstChar ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> (<span class="dt">String</span>, <span class="dt">String</span>)
    firstChar <span class="st">&quot;&quot;</span> <span class="fu">=</span> <span class="dt">Nothing</span>
    firstChar (c<span class="fu">:</span>cs) <span class="fu">=</span> <span class="kw">case</span> c <span class="kw">of</span>
      <span class="ch">'\\'</span> <span class="ot">-&gt;</span> <span class="kw">case</span> cs <span class="kw">of</span>
        <span class="co">-- Basic C-style escape characters</span>
        (<span class="ch">'a'</span> <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\a\&amp;&quot;</span>,ds)
        (<span class="ch">'b'</span> <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\b\&amp;&quot;</span>,ds)
        (<span class="ch">'f'</span> <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\f\&amp;&quot;</span>,ds)
        (<span class="ch">'n'</span> <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\n\&amp;&quot;</span>,ds)
        (<span class="ch">'r'</span> <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\r\&amp;&quot;</span>,ds)
        (<span class="ch">'t'</span> <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\t\&amp;&quot;</span>,ds)
        (<span class="ch">'v'</span> <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\v\&amp;&quot;</span>,ds)
        (<span class="ch">'\\'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\\\&amp;&quot;</span>,ds)
        (<span class="ch">'\''</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;'\&amp;&quot;</span> ,ds)
        (<span class="ch">'&quot;'</span> <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\&quot;\&amp;&quot;</span>,ds)
        (<span class="ch">'?'</span> <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;?\&amp;&quot;</span> ,ds)

        <span class="co">-- 3-digit octal ASCII codes</span>
        (<span class="ch">'0'</span><span class="fu">:</span>k2<span class="fu">:</span>k3<span class="fu">:</span>ds) <span class="ot">-&gt;</span> octalCode [<span class="ch">'0'</span>,k2,k3] ds
        (<span class="ch">'1'</span><span class="fu">:</span>k2<span class="fu">:</span>k3<span class="fu">:</span>ds) <span class="ot">-&gt;</span> octalCode [<span class="ch">'1'</span>,k2,k3] ds
        (<span class="ch">'2'</span><span class="fu">:</span>k2<span class="fu">:</span>k3<span class="fu">:</span>ds) <span class="ot">-&gt;</span> octalCode [<span class="ch">'2'</span>,k2,k3] ds
        (<span class="ch">'3'</span><span class="fu">:</span>k2<span class="fu">:</span>k3<span class="fu">:</span>ds) <span class="ot">-&gt;</span> octalCode [<span class="ch">'3'</span>,k2,k3] ds
        (<span class="ch">'4'</span><span class="fu">:</span>k2<span class="fu">:</span>k3<span class="fu">:</span>ds) <span class="ot">-&gt;</span> octalCode [<span class="ch">'4'</span>,k2,k3] ds
        (<span class="ch">'5'</span><span class="fu">:</span>k2<span class="fu">:</span>k3<span class="fu">:</span>ds) <span class="ot">-&gt;</span> octalCode [<span class="ch">'5'</span>,k2,k3] ds
        (<span class="ch">'6'</span><span class="fu">:</span>k2<span class="fu">:</span>k3<span class="fu">:</span>ds) <span class="ot">-&gt;</span> octalCode [<span class="ch">'6'</span>,k2,k3] ds
        (<span class="ch">'7'</span><span class="fu">:</span>k2<span class="fu">:</span>k3<span class="fu">:</span>ds) <span class="ot">-&gt;</span> octalCode [<span class="ch">'7'</span>,k2,k3] ds

        <span class="co">-- 2-digit hex ASCII codes</span>
        (<span class="ch">'x'</span><span class="fu">:</span>k1<span class="fu">:</span>k2<span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="kw">case</span> all isHexDigit digs <span class="kw">of</span>
          <span class="dt">True</span>  <span class="ot">-&gt;</span> <span class="kw">case</span> readLitChar (<span class="st">&quot;\\x&quot;</span> <span class="fu">++</span> digs) <span class="kw">of</span>
            []        <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\\x&quot;</span> <span class="fu">++</span> digs, ds)
            ((x,_)<span class="fu">:</span>_) <span class="ot">-&gt;</span> <span class="dt">Just</span> ([x],ds)
          <span class="dt">False</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\\x&quot;</span> <span class="fu">++</span> digs, ds)
          <span class="kw">where</span>
            digs <span class="fu">=</span> [k1,k2]

        <span class="co">-- Standard ASCII abbreviations</span>
        (<span class="ch">'N'</span><span class="fu">:</span><span class="ch">'U'</span><span class="fu">:</span><span class="ch">'L'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\NUL\&amp;&quot;</span>, ds)
        (<span class="ch">'S'</span><span class="fu">:</span><span class="ch">'O'</span><span class="fu">:</span><span class="ch">'H'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\SOH\&amp;&quot;</span>, ds)
        (<span class="ch">'S'</span><span class="fu">:</span><span class="ch">'T'</span><span class="fu">:</span><span class="ch">'X'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\STX\&amp;&quot;</span>, ds)
        (<span class="ch">'E'</span><span class="fu">:</span><span class="ch">'T'</span><span class="fu">:</span><span class="ch">'X'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\ETX\&amp;&quot;</span>, ds)
        (<span class="ch">'E'</span><span class="fu">:</span><span class="ch">'O'</span><span class="fu">:</span><span class="ch">'T'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\EOT\&amp;&quot;</span>, ds)
        (<span class="ch">'E'</span><span class="fu">:</span><span class="ch">'N'</span><span class="fu">:</span><span class="ch">'Q'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\ENQ\&amp;&quot;</span>, ds)
        (<span class="ch">'A'</span><span class="fu">:</span><span class="ch">'C'</span><span class="fu">:</span><span class="ch">'K'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\ACK\&amp;&quot;</span>, ds)
        (<span class="ch">'B'</span><span class="fu">:</span><span class="ch">'E'</span><span class="fu">:</span><span class="ch">'L'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\BEL\&amp;&quot;</span>, ds)
        (<span class="ch">'D'</span><span class="fu">:</span><span class="ch">'L'</span><span class="fu">:</span><span class="ch">'E'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\DLE\&amp;&quot;</span>, ds)
        (<span class="ch">'D'</span><span class="fu">:</span><span class="ch">'C'</span><span class="fu">:</span><span class="ch">'1'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\DC1\&amp;&quot;</span>, ds)
        (<span class="ch">'D'</span><span class="fu">:</span><span class="ch">'C'</span><span class="fu">:</span><span class="ch">'2'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\DC2\&amp;&quot;</span>, ds)
        (<span class="ch">'D'</span><span class="fu">:</span><span class="ch">'C'</span><span class="fu">:</span><span class="ch">'3'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\DC3\&amp;&quot;</span>, ds)
        (<span class="ch">'D'</span><span class="fu">:</span><span class="ch">'C'</span><span class="fu">:</span><span class="ch">'4'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\DC4\&amp;&quot;</span>, ds)
        (<span class="ch">'N'</span><span class="fu">:</span><span class="ch">'A'</span><span class="fu">:</span><span class="ch">'K'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\NAK\&amp;&quot;</span>, ds)
        (<span class="ch">'S'</span><span class="fu">:</span><span class="ch">'Y'</span><span class="fu">:</span><span class="ch">'N'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\SYN\&amp;&quot;</span>, ds)
        (<span class="ch">'E'</span><span class="fu">:</span><span class="ch">'T'</span><span class="fu">:</span><span class="ch">'B'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\ETB\&amp;&quot;</span>, ds)
        (<span class="ch">'C'</span><span class="fu">:</span><span class="ch">'A'</span><span class="fu">:</span><span class="ch">'N'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\CAN\&amp;&quot;</span>, ds)
        (<span class="ch">'S'</span><span class="fu">:</span><span class="ch">'U'</span><span class="fu">:</span><span class="ch">'B'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\SUB\&amp;&quot;</span>, ds)
        (<span class="ch">'E'</span><span class="fu">:</span><span class="ch">'S'</span><span class="fu">:</span><span class="ch">'C'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\ESC\&amp;&quot;</span>, ds)
        (<span class="ch">'D'</span><span class="fu">:</span><span class="ch">'E'</span><span class="fu">:</span><span class="ch">'L'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\DEL\&amp;&quot;</span>, ds)
        (<span class="ch">'E'</span><span class="fu">:</span><span class="ch">'M'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\EM\&amp;&quot;</span>,  ds)
        (<span class="ch">'F'</span><span class="fu">:</span><span class="ch">'S'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\FS\&amp;&quot;</span>,  ds)
        (<span class="ch">'G'</span><span class="fu">:</span><span class="ch">'S'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\GS\&amp;&quot;</span>,  ds)
        (<span class="ch">'R'</span><span class="fu">:</span><span class="ch">'S'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\RS\&amp;&quot;</span>,  ds)
        (<span class="ch">'U'</span><span class="fu">:</span><span class="ch">'S'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\US\&amp;&quot;</span>,  ds)
        (<span class="ch">'S'</span><span class="fu">:</span><span class="ch">'P'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\SP\&amp;&quot;</span>,  ds)
        (<span class="ch">'B'</span><span class="fu">:</span><span class="ch">'S'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\BS\&amp;&quot;</span>,  ds)
        (<span class="ch">'H'</span><span class="fu">:</span><span class="ch">'T'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\HT\&amp;&quot;</span>,  ds)
        (<span class="ch">'L'</span><span class="fu">:</span><span class="ch">'F'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\LF\&amp;&quot;</span>,  ds)
        (<span class="ch">'V'</span><span class="fu">:</span><span class="ch">'T'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\VT\&amp;&quot;</span>,  ds)
        (<span class="ch">'F'</span><span class="fu">:</span><span class="ch">'F'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\FF\&amp;&quot;</span>,  ds)
        (<span class="ch">'C'</span><span class="fu">:</span><span class="ch">'R'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\CR\&amp;&quot;</span>,  ds)
        (<span class="ch">'S'</span><span class="fu">:</span><span class="ch">'O'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\SO\&amp;&quot;</span>,  ds)
        (<span class="ch">'S'</span><span class="fu">:</span><span class="ch">'I'</span>    <span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\SI\&amp;&quot;</span>,  ds)

        <span class="co">-- C99-style universal character names</span>
        (<span class="ch">'u'</span><span class="fu">:</span>k1<span class="fu">:</span>k2<span class="fu">:</span>k3<span class="fu">:</span>k4<span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="kw">case</span> all isHexDigit digs <span class="kw">of</span>
          <span class="dt">True</span>  <span class="ot">-&gt;</span> <span class="kw">case</span> readLitChar (<span class="st">&quot;\\x&quot;</span> <span class="fu">++</span> digs) <span class="kw">of</span>
            []        <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\\u&quot;</span> <span class="fu">++</span> digs, ds)
            ((x,_)<span class="fu">:</span>_) <span class="ot">-&gt;</span> <span class="dt">Just</span> ([x],ds)
          <span class="dt">False</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\\u&quot;</span> <span class="fu">++</span> digs, ds)
          <span class="kw">where</span>
            digs <span class="fu">=</span> [k1,k2,k3,k4]

        (<span class="ch">'U'</span><span class="fu">:</span>k1<span class="fu">:</span>k2<span class="fu">:</span>k3<span class="fu">:</span>k4<span class="fu">:</span>k5<span class="fu">:</span>k6<span class="fu">:</span>k7<span class="fu">:</span>k8<span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="kw">case</span> all isHexDigit digs <span class="kw">of</span>
          <span class="dt">True</span>  <span class="ot">-&gt;</span> <span class="kw">case</span> readLitChar (<span class="st">&quot;\\x&quot;</span> <span class="fu">++</span> digs) <span class="kw">of</span>
            []        <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\\U&quot;</span> <span class="fu">++</span> digs, ds)
            ((x,_)<span class="fu">:</span>_) <span class="ot">-&gt;</span> <span class="dt">Just</span> ([x],ds)
          <span class="dt">False</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\\U&quot;</span> <span class="fu">++</span> digs, ds)
          <span class="kw">where</span>
            digs <span class="fu">=</span> [k1,k2,k3,k4,k5,k6,k7,k8]

        <span class="co">-- stolen from haskell</span>
        (<span class="ch">'&amp;'</span><span class="fu">:</span>ds) <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;&quot;</span>,ds)

        <span class="co">-- If we don't see a valid esc code, just move on.</span>
        ds <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="st">&quot;\\\&amp;&quot;</span>, ds)

      <span class="co">-- No backslash</span>
      otherwise <span class="ot">-&gt;</span> <span class="dt">Just</span> ([c],cs)
      <span class="kw">where</span>
<span class="ot">        isHexDigit ::</span> <span class="dt">Char</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
        isHexDigit <span class="fu">=</span> (<span class="ot">`elem`</span> <span class="st">&quot;0123456789aAbBcCdDeEfF&quot;</span>)

<span class="ot">        isOctDigit ::</span> <span class="dt">Char</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
        isOctDigit <span class="fu">=</span> (<span class="ot">`elem`</span> <span class="st">&quot;01234567&quot;</span>)

        octalCode digs ds <span class="fu">=</span> <span class="kw">case</span> all isOctDigit digs <span class="kw">of</span>
          <span class="dt">True</span>  <span class="ot">-&gt;</span> <span class="kw">case</span> readLitChar (<span class="st">&quot;\\o&quot;</span> <span class="fu">++</span> digs) <span class="kw">of</span>
            []        <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="ch">'\\'</span><span class="fu">:</span>digs, ds)
            ((x,_)<span class="fu">:</span>_) <span class="ot">-&gt;</span> <span class="dt">Just</span> ([x],ds)
          <span class="dt">False</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (<span class="ch">'\\'</span><span class="fu">:</span>digs, ds)</code></pre></div>
<p><a name="charecho"></a></p>
<h2 id="charecho-interpret-c-and-ascii-backslash-escape-codes-on-stdin"><code>charecho</code>: interpret C and ASCII backslash escape codes on stdin</h2>
<p>Here’s a version of <code>echo</code> that doesn’t add a trailing newline, for testing the character-oriented (rather than line-oriented) tools.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">-- sth-charecho: write arguments to stdout, without trailing newline</span>

<span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">SoftwareTools.Lib</span>
  ((<span class="fu">&gt;&gt;&gt;</span>), getArgs, exitSuccess, intercalate)

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> getArgs
  <span class="fu">&gt;&gt;=</span> (intercalate <span class="st">&quot; &quot;</span> <span class="fu">&gt;&gt;&gt;</span> putStr)
  <span class="fu">&gt;&gt;</span>  exitSuccess</code></pre></div>

<!-- END BODY -->
</div>

<div id="footer">
  Site generated by
  <a href="http://jaspervdj.be/hakyll">Hakyll</a>
</div>
</body>
</html>
